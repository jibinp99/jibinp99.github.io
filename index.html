<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		 
		<meta name="description" content="">
		<meta name="author" content="Jibin P">
        <title>Ripple Notification</title>
        <script type="text/javascript">
			var coinMarketVal = 0;
			var percentage1 = 0
			setInterval(function() {
				getCoinMarketVal();
			}, 60 * 1000);
			function getCoinMarketVal() {
			  var xhttp = new XMLHttpRequest();
			  xhttp.onreadystatechange = function() {
				if (this.readyState == 4 && this.status == 200) {
				  var obj = JSON.parse(this.responseText);
				  coinMarketValNew = obj[0].price_inr;
				  if(coinMarketVal ==0){
					coinMarketVal = coinMarketValNew;
					trigger_notification(obj);
				  }else {
				     percentage1 = 0;
					if(coinMarketVal<coinMarketValNew){
						percentage1 = ((coinMarketValNew - coinMarketVal)/coinMarketVal)*100;
					} else if(coinMarketVal>coinMarketValNew){
						percentage1 = ((coinMarketValNew - coinMarketVal)/coinMarketVal)*100;
					}
					if( percentage1 >=1 || percentage1 <= -1){
						trigger_notification(obj);
					}
				  }
				}
			  };
			  xhttp.open("GET", "https://api.coinmarketcap.com/v1/ticker/ripple/?convert=INR", true);
			  xhttp.send();
			}
			
            function trigger_notification(obj)
            {
                //check if browser supports notification API
                if("Notification" in window)
                {
                    if(Notification.permission == "granted")
                    {
                        var notification = new Notification("Ripple Rate Alert", {"body":"Starting : Rs "+coinMarketVal+"\nCurrent : Rs "+coinMarketValNew+"\n%Change 1h : "+obj[0].percent_change_1h+"\n%Change 24h : "+obj[0].percent_change_24h, "icon":"http://qnimate.com/wp-content/uploads/2014/07/web-notification-api-300x150.jpg"});
                    }
                    else
                    {
                        Notification.requestPermission(function (permission) {
                            if (permission === "granted")
                            {
                                var notification = new Notification("Ripple Rate Alert", {"body":"Starting : Rs "+coinMarketVal+"\nCurrent : Rs "+coinMarketValNew+"\n%Change 1h : "+obj[0].percent_change_1h+"\n%Change 24h : "+obj[0].percent_change_24h, "icon":"http://qnimate.com/wp-content/uploads/2014/07/web-notification-api-300x150.jpg"});
                            }
                        });
                    }
                }  
                else
                {
                    alert("Your browser doesn't support notfication API");
                }      
            }
        </script>
    </head>
    <body>
        <button onclick="getCoinMarketVal();">Get Notification</button>
    </body>
</html>